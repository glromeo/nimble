<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Benchmarks</title>
</head>
<body>
<div id="root"></div>
<script type="module">

    customElements.define('i-node', class extends HTMLElement {
        constructor() {
            super()
        }
        connectedCallback() {
            this.connect?.()
        }
        disconnectedCallback() {
            this.disconnect?.()
        }
    })

    const I_NODE = document.createElement('i-node')

    setTimeout(() => {
        let div

        console.time('comment -> text')
        div = document.body.appendChild(document.createElement('div'))
        div.id = 'comment'
        for (let i = 0; i < 100; i++) {
            const ref = div.appendChild(document.createComment(i))
            for (let j = 0; j < 10; j++) {
                const txt = document.createTextNode(j)
                ref.replaceWith(txt)
                for (let i = 0; i < 1000; i++) {
                    txt.data = i
                }
            }
        }
        div.innerHTML = ''
        console.timeEnd('comment -> text')

        console.time('i-node -> text')
        div = document.body.appendChild(document.createElement('div'))
        div.id = 'i-node'
        for (let i = 0; i < 100; i++) {
            const ref = div.appendChild(document.createComment(i))
            for (let j = 0; j < 10; j++) {
                const inode = I_NODE.cloneNode(true)
                ref.replaceWith(inode)
                for (let i = 0; i < 1000; i++) {
                    inode.textContent = i
                }
            }
        }
        div.innerHTML = ''
        console.timeEnd('i-node -> text')

        console.time('comment -> mix')
        div = document.body.appendChild(document.createElement('div'))
        div.id = 'comment'
        for (let i = 0; i < 100; i++) {
            const ref = div.appendChild(document.createComment(i))
            for (let j = 0; j < 10; j++) {
                if (j % 2 === 0) {
                    const txt = document.createTextNode(j)
                    ref.replaceWith(txt)
                    for (let i = 0; i < 1000; i++) {
                        txt.data = i
                    }
                } else {
                    const inode = I_NODE.cloneNode(true)
                    ref.replaceWith(inode)
                    for (let i = 0; i < 1000; i++) {
                        inode.textContent = i
                    }
                }
            }
        }
        div.innerHTML = ''
        console.timeEnd('comment -> mix')

        console.time('comment -> nodes')
        div = document.body.appendChild(document.createElement('div'))
        div.id = 'comment'
        for (let i = 0; i < 100; i++) {
            const ref = div.appendChild(document.createComment(''))
            for (let j = 0; j < 10; j++) {
                const f = document.createDocumentFragment()
                for (let i = 0; i < 100; i++) {
                    f.appendChild(document.createElement('div'))
                }
                ref.firstSibling = f.firstChild
                ref.parentNode.insertBefore(f, ref)
                for (let node = ref.previousSibling; node !== ref.firstSibling; node = ref.previousSibling) {
                    node.remove()
                }
            }
        }
        div.innerHTML = ''
        console.timeEnd('comment -> nodes')

        console.time('slot -> nodes')
        div = document.body.appendChild(document.createElement('div'))
        div.id = 'slot'
        for (let i = 0; i < 100; i++) {
            const ref = div.appendChild(document.createElement('slot'))
            for (let j = 0; j < 10; j++) {
                const f = document.createDocumentFragment()
                for (let i = 0; i < 100; i++) {
                    f.appendChild(document.createElement('div'))
                }
                ref.appendChild(f)
                ref.replaceChildren()
            }
        }
        div.innerHTML = ''
        console.timeEnd('slot -> nodes')

        console.time('i-node -> nodes')
        div = document.body.appendChild(document.createElement('div'))
        div.id = 'i-node'
        for (let i = 0; i < 100; i++) {
            const ref = div.appendChild(I_NODE.cloneNode(true))
            for (let j = 0; j < 10; j++) {
                const f = document.createDocumentFragment()
                for (let i = 0; i < 100; i++) {
                    f.appendChild(document.createElement('div'))
                }
                ref.appendChild(f)
                ref.replaceChildren()
            }
        }
        div.innerHTML = ''
        console.timeEnd('i-node -> nodes')

    }, 1000)

</script>
</body>
</html>
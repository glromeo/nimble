<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML Tagged Template Simple Parser</title>
    <style>
        i-node {
            display: contents;
        }
    </style>
</head>
<body>
<div id="root"></div>
<script src="../../node_modules/chai/chai.js"></script>
<script src="../../node_modules/mocha/mocha.js"></script>
<script type="module">
    import {WebConsole} from '../test/web-console.mjs'
    import {atom, molecule} from '../atoms/atoms.mjs'
    import {html} from '../html/html.mjs'

    mocha.setup('tdd')
    mocha.checkLeaks()
    mocha.reporter(WebConsole)

    const {expect} = chai

    suite('text nodes', () => {

        let fixtureNumber = 0, testNumber = 0
        setup(() => {
            ++testNumber
            fixtureNumber = 0
        })

        const render = template => {
            const fixture = document.getElementById('root').appendChild(document.createElement('div'))
            fixture.setAttribute('class', 'fixture')
            fixture.setAttribute('data-test', String(testNumber))
            fixture.setAttribute('data-fixture', String(fixtureNumber++))
            template.bind?.(molecule())
            fixture.appendChild(template)
            return fixture
        }
        const expectHTML = template => expect(render(template).innerHTML)
        const expectText = template => expect(render(template).innerText)

        test(`#00`, () => expectHTML(html`hello`).to.eq('hello'))
        test(`#01`, () => expectHTML(html`<div label="hello"/>`).to.eq('<div label="hello"></div>'))
        test(`#02`, () => expectHTML(html` hello ${' '} world   ! `).to.eq(' hello   world ! '))
        test(`#03`, () => expectHTML(html` hello ${[1, BigInt(2), ' ']} world   ! `).to.eq(' hello 12  world ! '))
        test(`#04`, () => expectHTML(html` <my-tag></my-tag>`).to.eq(' <my-tag></my-tag>'))
        test(`#05`, () => expectHTML(html`   <p> t t </p>   `).to.eq(' <p> t t </p> '))
        test(`#06`, () => expectHTML(html`<p>hello</p>`).to.eq('<p>hello</p>'))
        test(`#07`, () => expectHTML(html`<p>hello<p>world</p></p>`).to.eq('<p>hello<p>world</p></p>'))
        test(`#08`, () => expectHTML(html`<!-- <hello> -->`).to.eq('<!-- <hello> -->'))
        test(`#09`, () => expectHTML(html`<!- > -->`).to.eq('<!--- --> --&gt;'))
        test(`#10`, () => expectHTML(html`<p a></p>`).to.eq('<p a=""></p>'))
        test(`#11`, () => expectHTML(html`<p a=b></p>`).to.eq('<p a="b"></p>'))
        test(`#12`, () => expectHTML(html`<p a='b > d'></p>`).to.eq('<p a="b > d"></p>'))
        test(`#13`, () => expectHTML(html`<p a=${'b'}><a b=${'c'}></a></p>`).to.eq('<p a="b"><a b="c"></a></p>'))
        test(`#14`, () => expectHTML(html`<p a${{b: 'c'}}></p>`).to.eq('<p a="" b="c"></p>'))
        test(`#15`, () => expectHTML(html`<p a="abc${'def'}ghi${'   '}jkl"></p>`).to.eq('<p a="abcdefghi   jkl"></p>'))
        test(`#16`, () => expectHTML(html`<!-- ${'one'} ${2} -->`).to.eq('<!-- one 2 -->'))
        test(`#17`, () => expectHTML(html`hello ${atom('world')}`).to.eq('hello world'))
        test(`#18`, () => expectHTML(html`${['I',[2.1,2.2,2.3],'X',[4.1,4.2,4.3],'V']}`).to.eq('I2.12.22.3X4.14.24.3V'))
        test(`#19`, () => expectHTML(html`hello ${html`world`}`).to.eq('hello world'))
        test(`#20`, () => expectHTML(html`hello ${html`${atom('world')}`}`).to.eq('hello world'))
        test(`#21`, () => expectHTML(html`<${{tag:'svg'}} width="100" height=${"50"}></>`).to.eq('<svg width="100" height="50"></svg>'))
        test(`#22`, () => expectHTML(html` <img> `).to.eq(' <img> '))
        test(`#23`, () => expectHTML(html` <${atom({tag:'svg'})}> `).to.eq(' <svg></svg> '))
        test(`#24`, () => expectHTML(html`<!-- ${atom('hello')} ${'world'} -->`).to.eq('<!-- hello world -->'))
    })

    mocha.run()
</script>
</body>
</html>
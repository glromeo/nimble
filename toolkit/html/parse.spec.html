<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML Tagged Template Simple Parser</title>
    <style>
        i-node {
            display: contents;
        }
    </style>
</head>
<body>
<div id="root"></div>
<script src="../../node_modules/chai/chai.js"></script>
<script src="../../node_modules/mocha/mocha.js"></script>
<script type="module">
    import {WebConsole} from '../test/web-console.mjs'
    import {atom, molecule} from '../atoms/atoms.mjs'
    import {html} from '../html/html.mjs'

    mocha.setup('tdd')
    mocha.checkLeaks()
    mocha.reporter(WebConsole)

    const {expect} = chai

    suite('text nodes', () => {

        let testNumber = 0, fixtureNumber, scope
        setup(() => {
            ++testNumber
            fixtureNumber = 0
            scope = molecule()
        })

        const render = template => {
            const fixture = document.getElementById('root').appendChild(document.createElement('div'))
            fixture.setAttribute('class', 'fixture')
            fixture.setAttribute('data-test', String(testNumber))
            fixture.setAttribute('data-fixture', String(fixtureNumber++))
            fixture.replaceChildren(template(scope))
            return fixture
        }
        const expectHTML = template => expect(render(template).innerHTML)
        const expectText = template => expect(render(template).innerText)

        test(`#00`, () => expectHTML(html`hello`).to.eq('hello'))
        test(`#01`, () => expectHTML(html`<p>hello</p>`).to.eq('<p>hello</p>'))
        test(`#02`, () => expectHTML(html` <my-tag></my-tag> `).to.eq(' <my-tag></my-tag> '))
        test(`#03`, () => expectHTML(html`ciao<p>hello</p>salut`).to.eq('ciao<p>hello</p>salut'))
        test(`#04`, () => expectHTML(html`   <p> t t </p>   `).to.eq(' <p> t t </p> '))
        test(`#05`, () => expectHTML(html`<p>hello<p>world</p></p>`).to.eq('<p>hello<p>world</p></p>'))
        test(`#06`, () => expectHTML(html`<div label="hello"/>`).to.eq('<div label="hello"></div>'))
        test(`#07`, () => expectHTML(
            html`<svg height="90" width="160"><line x1="0" y1="0" x2="160" y2="90" style="stroke:blue;stroke-width:4" /></svg>`
        ).to.eq(
            '<svg height="90" width="160"><line x1="0" y1="0" x2="160" y2="90" style="stroke:blue;stroke-width:4"></line></svg>'
        ))
        test(`#08`, () => expectHTML(html` hello ${' '} world   ! `).to.eq(' hello   world ! '))
        test(`#09`, () => expectHTML(html`${1}<p>${[1, BigInt(2), ' ']}</p>${true}`).to.eq('1<p>12 </p>'))
        test(`#10`, () => expectHTML(html`<!-- <hello> -->`).to.eq('<!-- <hello> -->'))
        test(`#11`, () => expectHTML(html`<!- > -->`).to.eq('<!--- --> --&gt;'))
        test(`#12`, () => expectHTML(html`<p a></p>`).to.eq('<p a=""></p>'))
        test(`#13`, () => expectHTML(html`<p a=b></p>`).to.eq('<p a="b"></p>'))
        test(`#14`, () => expectHTML(html`<p a='b > d'></p>`).to.eq('<p a="b > d"></p>'))
        test(`#15`, () => expectHTML(html`<p a=${'b'}><a b=${2} c=${true}></a></p>`).to.eq('<p a="b"><a b="2" c=""></a></p>'))
        test(`#16`, () => expectHTML(html`<p fn=${function (node) {
            expect(this).to.eq(scope)
            expect(node.tagName).to.eq('P')
            return "ok"
        }}></p>`).to.eq('<p fn="ok"></p>'))
        test(`#17`, () => expectHTML(html`<p a${{b: 'c'}}></p>`).to.eq('<p a="" b="c"></p>'))
        test(`#18`, () => expectHTML(html`<p a="abc${'def'}ghi${'   '}jkl"></p>`).to.eq('<p a="abcdefghi   jkl"></p>'))
        test(`#19`, () => expectHTML(html`<!-- ${'one'} ${2} -->`).to.eq('<!-- one 2 -->'))
        test(`#20`, () => expectHTML(html` <p>${function (node) {
            expect(this).to.eq(scope)
            expect(node.tagName).to.eq('P')
            return "hello"
        }}</p> `).to.eq(' <p>hello</p> '))
        test(`#21`, () => expectHTML(html` <img> `).to.eq(' <img> '))

return
        test(`#22`, () => expectHTML(html` <${function (context) {
            expect(this).to.eq(scope)
            const {a, b, c} = context
            expect(a).to.eq('1')
            expect(b).to.eq(2)
            expect(c).to.eq(3)
            expect(context.nodeName).to.eq('#document-fragment')
            return {tag:'img', attrs: {src:'about:blank'}}
        }} a="1" b=${2} c="${3}">hello <p>world</p>${'!'}</>`).to.eq(' <img src="about:blank"> '))
        return;
        test(`#19`, () => expectHTML(html`hello ${atom('world')}`).to.eq('hello world'))
        test(`#20`, () => expectHTML(html`${['I',[2.1,2.2,2.3],'X',[4.1,4.2,4.3],'V']}`).to.eq('I2.12.22.3X4.14.24.3V'))
        test(`#21`, () => expectHTML(html`hello ${html`world`}`).to.eq('hello world'))
        test(`#22`, () => expectHTML(html`hello ${html`${atom('world')}`}`).to.eq('hello world'))
        test(`#23`, () => expectHTML(html`<${{tag:'svg'}} width="100" height=${"50"}></>`).to.eq('<svg width="100" height="50"></svg>'))

        test(`#25`, () => expectHTML(html` <${atom({tag:'svg'})}> `).to.eq(' <svg></svg> '))
        test(`#26`, () => expectHTML(html`<!-- ${atom('hello')} ${'world'} -->`).to.eq('<!-- hello world -->'))
    })

    mocha.run()
</script>
</body>
</html>
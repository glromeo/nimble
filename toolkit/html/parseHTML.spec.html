<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>parseHTML spec</title>
</head>
<body>
<div id="root"></div>
<script type="module">
    import {
        parseHTML,
        HOLE,
        APPEND_TEXT,
        APPEND_COMMENT,
        APPEND_CHILD,
        BOOL_ATTR,
        SET_ATTR,
        PARENT_NODE,
        HOOK_NODE,
        HOOK_ELEMENT,
        HOOK_COMMENT,
        HOOK_ATTR,
        HOOK_VALUE,
        HOOK_QUOTE
    } from "./parseHTML.mjs";

    let passed = 0, failed = 0;

    const test = (id, input, commands, args) => {
        const expected = JSON.stringify([commands, args]);
        const actual = JSON.stringify(parseHTML(input));
        if (actual !== expected) {
            failed++;
            console.error(`Test #${id} failed`, "\n\texpected:", expected, "\n\tactual:  ", actual);
        } else {
            passed++;
        }
    };

    console.time("parseHTML");

    test("00", "", [], []);
    test("01", " ", [APPEND_TEXT], [" "]);
    test("02", " <", [APPEND_TEXT], [" <"]);
    test("03", " < ", [APPEND_TEXT], [" < "]);
    test("04", " <>", [APPEND_TEXT, APPEND_CHILD], [" ", "slot"]);
    test("05", " <a", [APPEND_TEXT], [" "]);
    test("06", " <a ", [APPEND_TEXT], [" "]);
    test("07", " <a b", [APPEND_TEXT], [" "]);
    test("08", " <a a ", [APPEND_TEXT], [" ", "a"]); // It doesn't really matter
    test("09", " <a b=", [APPEND_TEXT], [" "]);
    test("10", " <a b=c", [APPEND_TEXT], [" "]);
    test("11", " <a b=c ", [APPEND_TEXT], [" "]);
    test("12", "<p><a b=c /", [APPEND_CHILD], ["p"]);
    test("13", " <a b=\"c\"", [APPEND_TEXT], [" "]);
    test("14", " <svg ", [APPEND_TEXT], [" "]);
    test("15", " <a>", [APPEND_TEXT, APPEND_CHILD], [" ", "a"]);
    test("16", " <svg>", [APPEND_TEXT, APPEND_CHILD], [" ", "svg"]);
    test("17", "<A>", [APPEND_CHILD], ["a"]);
    test("18", "<SVG>", [APPEND_CHILD], ["svg"]);
    test("19", "<p>hello</p>", [APPEND_CHILD, APPEND_TEXT, PARENT_NODE], ["p", "hello"]);
    test("20", "</>", [PARENT_NODE], []);
    test("21", "< />", [APPEND_TEXT], ["< />"]);
    test("22", "<a/>", [APPEND_CHILD, PARENT_NODE], ["a"]);
    test("23", "<a />", [APPEND_CHILD, PARENT_NODE], ["a"]);
    test("24", "<a / >", [APPEND_CHILD], ["a"]);
    test("25", "<a //>", [APPEND_CHILD, PARENT_NODE], ["a"]);
    test("26", "<a u>", [APPEND_CHILD, BOOL_ATTR], ["a", "u"]);
    test("27", "<a =u>", [APPEND_CHILD, BOOL_ATTR], ["a", "=u"]); // This will fail later on...
    test("28", "<a u/>", [APPEND_CHILD, BOOL_ATTR, PARENT_NODE], ["a", "u"]);
    test("29", "<a u=/>", [APPEND_CHILD, SET_ATTR, PARENT_NODE], ["a", "u", ""]);
    test("30", "<a u=1>", [APPEND_CHILD, SET_ATTR], ["a", "u", "1"]);
    test("31", "<a u=1/>", [APPEND_CHILD, SET_ATTR, PARENT_NODE], ["a", "u", "1"]);
    test("32", "<a U=1 >", [APPEND_CHILD, SET_ATTR], ["a", "U", "1"]);
    test("33", "<a u=\"2\">", [APPEND_CHILD, SET_ATTR], ["a", "u", "2"]);
    test("34", `<a u='3'>`, [APPEND_CHILD, SET_ATTR], ["a", "u", "3"]);
    test("35", `<a "b c"=d>`, [APPEND_CHILD, BOOL_ATTR, SET_ATTR], ["a", "\"b", "c\"", "d"]);
    test("36", `<a u='3' f="g"/>`, [APPEND_CHILD, SET_ATTR, SET_ATTR, PARENT_NODE], ["a", "u", "3", "f", "g"]);
    test("37", `<img>`, [APPEND_CHILD, PARENT_NODE], ["img"]);
    test("38", "<img src>", [APPEND_CHILD, BOOL_ATTR, PARENT_NODE], ["img", "src"]);
    test("39", "<img src >", [APPEND_CHILD, BOOL_ATTR, PARENT_NODE], ["img", "src"]);
    test("40", "<img src/>", [APPEND_CHILD, BOOL_ATTR, PARENT_NODE], ["img", "src"]);
    test("41", "<img src />", [APPEND_CHILD, BOOL_ATTR, PARENT_NODE], ["img", "src"]);
    test("42", "<img class=\"image\" >", [APPEND_CHILD, SET_ATTR, PARENT_NODE], ["img", "class", "image"]);
    test("43", "<img class=\"image\" />", [APPEND_CHILD, SET_ATTR, PARENT_NODE], ["img", "class", "image"]);
    test("44", `  pre  <p><img></p>  post  `, [APPEND_TEXT, APPEND_CHILD, APPEND_CHILD, PARENT_NODE, PARENT_NODE, APPEND_TEXT], ["  pre  ", "p", "img", "  post  "]);
    test("45", `<!>`, [APPEND_COMMENT], [""]);
    test("46", `<!->`, [APPEND_COMMENT], ["-"]);
    test("47", `<!-->`, [APPEND_COMMENT], [""]);
    test("48", `<!--->`, [APPEND_COMMENT], [""]);
    test("49", `<!---->`, [APPEND_COMMENT], [""]);
    test("50", `<!-->-->`, [APPEND_COMMENT, APPEND_TEXT], ["", "-->"]);
    test("51", `<!-- > -->`, [APPEND_COMMENT], [" > "]);
    test("52", `<!-- -> -->`, [APPEND_COMMENT], [" -> "]);
    test("53", `<!-- --> -->`, [APPEND_COMMENT, APPEND_TEXT], [" ", " -->"]);
    test("54", ` <!--no comment--> `, [APPEND_TEXT, APPEND_COMMENT, APPEND_TEXT], [" ", "no comment", " "]);
    test("55", `${HOLE}`, [HOOK_NODE], []);
    test("56", `x${HOLE}y`, [APPEND_TEXT, HOOK_NODE, APPEND_TEXT], ["x", "y"]);
    test("57", `<${HOLE}>`, [HOOK_ELEMENT], []);
    test("58", `<p${HOLE}>`, [APPEND_CHILD, HOOK_ATTR], ["p"]);
    test("59", `<p a${HOLE}>`, [APPEND_CHILD, BOOL_ATTR, HOOK_ATTR], ["p", "a"]);
    test("60", `<p ${HOLE} ${HOLE}>`, [APPEND_CHILD, HOOK_ATTR, HOOK_ATTR], ["p"]);
    test("61", `<p${HOLE} />`, [APPEND_CHILD, HOOK_ATTR, PARENT_NODE], ["p"]);
    test("62", `<a />xyz<p${HOLE}a>`, [APPEND_CHILD, PARENT_NODE, APPEND_TEXT, APPEND_CHILD, HOOK_ATTR, BOOL_ATTR], ["a", "xyz", "p", "a"]);
    test("63", `<${HOLE} a=b>`, [HOOK_ELEMENT, SET_ATTR], ["a", "b"]);
    test("64", `<b ${HOLE}=${HOLE}>`, [APPEND_CHILD, HOOK_ATTR, BOOL_ATTR, HOOK_ATTR], ["b", "="]);
    test("65", `<b a=${HOLE}>`, [APPEND_CHILD, HOOK_VALUE], ["b", "a"]);
    test("66", `<b a='${HOLE}'>`, [APPEND_CHILD, HOOK_VALUE], ["b", "a"]);
    test("67", `<b a="${HOLE}">`, [APPEND_CHILD, HOOK_VALUE], ["b", "a"]);
    test("68", `<b a=b${HOLE}>`, [APPEND_CHILD, SET_ATTR, HOOK_ATTR], ["b", "a", "b"]);
    test("69", `<b a=b${HOLE}c d>`, [APPEND_CHILD, SET_ATTR, HOOK_ATTR, BOOL_ATTR, BOOL_ATTR], ["b", "a", "b", "c", "d"]);
    test("70", `<b a='b${HOLE}c'>`, [APPEND_CHILD, HOOK_QUOTE], ["b", "a", "b\x01c"]);
    test("71", `<!-- ${HOLE} -->`, [HOOK_COMMENT], [" \x01 "]);
    test("72", `<a><b>x</b></a>`, [APPEND_CHILD, APPEND_CHILD, APPEND_TEXT, PARENT_NODE, PARENT_NODE], ["a", "b", "x"]);
    test("73", `<a><b>x${HOLE}</b></a>`, [APPEND_CHILD, APPEND_CHILD, APPEND_TEXT, HOOK_NODE, PARENT_NODE, PARENT_NODE], ["a", "b", "x"]);

    console.timeEnd("parseHTML");

    if (failed) {
        console.log("Failed:", passed, "tests passed", failed, "tests failed");
    } else {
        console.log("OK!", passed, "tests passed");
    }

</script>
</body>
</html>
